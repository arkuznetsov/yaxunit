---
description: 
globs: tests/**/*.bsl
alwaysApply: false
---
# Рекомендации по тестированию с использованием YAxUnit

## Общие принципы
1. Тесты должны быть:
   - Независимыми
   - Воспроизводимыми
   - Быстрыми
   - Понятными
   - Поддерживаемыми

2. Организация тестов:
   - Создавать отдельный каталог для тестов
   - Группировать тесты по функциональности
   - Использовать префикс "Тест" для имен тестовых процедур
   - Создавать тестовые данные в начале теста

Test generation rules

- Тесты должны располагаться в директории `tests/src/`.
- Тесты это общие модули и должны быть расположены в `tests/src/CommonModules`
- Каждый тестовый модуль должен быть назван по шаблону`[Префикс типа объекта_][Имя проверяемого объект]{_Суффикс типа модуля}`, где суффикс не обязателен, но крайне желателен.

    #### Префиксы типов объекта

    | Тип тестируемого объекта | Префикс | Пример                                      |
    | ------------------------ | ------- | ------------------------------------------- |
    | Общий модуль             | `ОМ_`     | ОМ_ОбщегоНазначения                         |
    | Регистр бухгалтерии      | `РБ_`     | РБ_Хозрасчетный, РБ_Хозрасчетный_НЗ         |
    | Регистр накопления       | `РН_`     | РН_ОстаткиНаСкладах, РН_ОстаткиНаСкладах_ММ |
    | Регистр расчета          | `РР_`     | РР_Зарплата, РР_Зарплата_НЗ                 |
    | Регистр сведений         | `РС_`     | РС_АдресныйКлассификатор                    |
    | Бизнес процесс           | `БП_`     | БП_Согласование                             |
    | Справочник               | `Спр_`    | Спр_Пользователи, Спр_Пользователи_МО       |
    | План счетов              | `ПС_`     | ПС_Хозрасчетный                             |
    | План видов расчета       | `ПВР_`    | ПВР_Зарплатный                              |
    | План видов характеристик | `ПВХ_`    | ПВХ_Субконто, ПВХ_Субконто_ММ               |
    | Документ                 | `Док_`    | Док_ПКО                                     |
    | Перечисление             | `Пер_`    | Пер_СтатусСогласования                      |
    | План обмена              | `ПО_`     | ПО_РИБ, ПО_РИБ_ММ                           |
    | Задача                   | `Зад_`    | Зад_Задача                                  |
    | Обработка                | `Обр_`    | Обр_ЗакрытиеМесяца, Обр_ЗакрытиеМесяца_МО   |
    | Отчет                    | `Отч_`    | Отч_УниверсальныйОтчет                      |
    #### Суффиксы типов модулей

    | Тип тестируемого модуля | Суффикс        | Пример                                     |
    | ----------------------- | -------------- | ------------------------------------------ |
    | Общий модуль            | `<Без суффикса>` | ОМ_ОбщегоНазначения                        |
    | Модуль объекта          | `_МО`            | Спр_Пользователи_МО, Обр_ЗакрытиеМесяца_МО |
    | Модуль менеджера        | `_ММ`            | ПВХ_Субконто_ММ, ПО_РИБ_ММ                 |
    | Модуль набора записей   | `_НЗ`            | РБ_Хозрасчетный_НЗ, РР_Зарплата_НЗ         |
    Примеры: Для документа `ПоступлениеДенег` тестовый модуль будет иметь имя `Док_ПоступлениеДенег` и будет располагатся `tests/src/CommonModules/Док_ПоступлениеДенег/Module.bsl`
- Для тестового модуля необходимо создай файлы если они отсутствуют
    - Создать каталог `tests/src/CommonModules/[Имя модуля]`
    - Создать описание, при отсутствии, `tests/src/CommonModules/[Имя модуля]/[Имя модуля].mdo` как и любого другого общего модуля
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <mdclass:CommonModule xmlns:mdclass="http://g5.1c.ru/v8/dt/metadata/mdclass" uuid={uuidgen}>
    <name>[Имя модуля]</name>
    <clientManagedApplication>true</clientManagedApplication>
    <server>true</server>
    <clientOrdinaryApplication>true</clientOrdinaryApplication>
    </mdclass:CommonModule>
    ```
      - Не обновляй файл описания `tests/src/CommonModules/[Имя модуля]/[Имя модуля].mdo` если он существует
      - для модулей объектов и менеджеров <server>true</server> остальные false
      - для общих модулей флаги clientManagedApplication, server и clientOrdinaryApplication в соответствии с настройками проверяемого модуля
    - Создать тестовый модуль `tests/src/CommonModules/[Имя модуля]/Module.bsl`
    - Обязательно зарегистрировать новый тестовый модуль в конфигурации `tests/src/Configuration/Configuration.mdo`
    - Не нужно создавать описание тестов в формате markdown
- Тест состоит из обязательных частей:
    - Регистрация в методе `ИсполняемыеСценарии`
    - Имя тестового метода равно имени проверяемого метода, не должно содержать префиксов/суффиксов "Тест"
    - При регистрации используй fluent интерфейс
    - Реализация теста
- Доступна обработка событий, обработчики это экспортные процедуры без параметров
    - ПередВсемиТестами
    - ПередТестовымНабором
    - ПередКаждымТестом
    - ПослеКаждогоТеста
    - ПослеТестовогоНабора
    - ПослеВсехТестов

## Структура тестового модуля
```bsl

#Область СлужебныйПрограммныйИнтерфейс
// Общий модуль с тестами
Процедура ИсполняемыеСценарии() Экспорт
    ЮТТесты
        .ДобавитьТест("СозданиеДокумента")
            .СПараметрами(ТестовыеДанные1, ОжидаемыйРезультат1)
            .СПараметрами(ТестовыеДанные2, ОжидаемыйРезультат2);
КонецПроцедуры

Процедура СозданиеДокумента(ТестовыеДанные, ОжидаемыйРезультат) Экспорт
    // Подготовка данных
    ПодготовитьТестовыеДанные(ТестовыеДанные);
    
    // Выполнение тестируемого кода
    Документ = СоздатьДокумент(ТестовыеДанные);
    
    // Проверки
    ЮТест.ОжидаетЧто(Документ.Номер)
        .Равно(ОжидаемыйРезультат.Номер);
    
    ЮТест.ОжидаетЧто(Документ.Дата)
        .Равно(ОжидаемыйРезультат.Дата);
    
    // Очистка
    ОчиститьТестовыеДанные(ТестовыеДанные);
КонецПроцедуры

#КонецОбласти
```

## Типы проверок
1. Базовые проверки:
   - Равно
   - НеРавно
   - Больше
   - Меньше
   - Заполнено
   - НеЗаполнено

2. Проверки коллекций:
   - Содержит
   - НеСодержит
   - КоличествоЭлементов
   - Пустой
   - НеПустой

3. Проверки типов:
   - ИмеетТип
   - НеИмеетТип

## Рекомендации по написанию тестов
1. Подготовка данных:
   - Создавать тестовые данные в начале теста
   - Использовать фабрики для создания тестовых данных
   - Очищать тестовые данные после выполнения теста

2. Проверки:
   - Проверять граничные условия
   - Тестировать обработку ошибок
   - Проверять корректность данных
   - Тестировать производительность

3. Документирование:
   - Добавлять комментарии к тестам
   - Описывать назначение каждого теста
   - Указывать предварительные условия
   - Документировать ожидаемые результаты

## Возможности

### Хранение промежуточных данных

* ЮТест.Контекст() - позволяет получать и сохранять данные в глобальном контексте
  Методы:
    * Значение(ИмяЗначения:Строка): Произвольный - Возвращает значение контекста
    * УстановитьЗначение(ИмяЗначения:Строка, Значение:Произвольный) - Устанавливает значение в контекст тестов.
